<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arduino Voice Control and Camera</title>
</head>
<body>
    <h1>Control Your Robot with Voice</h1>
    <button onclick="startRecognition()">Start Voice Recognition</button>
    <p id="status">Status: Not Listening</p>
    <img id="cameraStream" src="" alt="Camera Stream" width="320" height="240">
    
    <h2>Manual Control</h2>
    <button onclick="sendCommand('forward')">Move Forward</button>
    <button onclick="sendCommand('backward')">Move Backward</button>
    <button onclick="sendCommand('left')">Turn Left</button>
    <button onclick="sendCommand('right')">Turn Right</button>

    <script>
        function startRecognition() {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                document.getElementById('status').textContent = 'Status: Listening...';
            };

            recognition.onresult = (event) => {
                const command = event.results[0][0].transcript.toLowerCase();
                document.getElementById('status').textContent = 'Status: Command Received - ' + command;

                if (command.includes('forward')) {
                    sendCommand('forward');
                } else if (command.includes('backward')) {
                    sendCommand('backward');
                } else if (command.includes('left')) {
                    sendCommand('left');
                } else if (command.includes('right')) {
                    sendCommand('right');
                } else {
                    document.getElementById('status').textContent = 'Status: Command not recognized';
                }
            };

            recognition.onerror = (event) => {
                document.getElementById('status').textContent = 'Error occurred in recognition: ' + event.error;
            };

            recognition.start();
        }

        function sendCommand(command) {
            const ipAddress = '192.168.4.1'; // Update to your Arduino's IP
            const url = `http://${ipAddress}/command?move=${command}`;

            fetch(url)
                .then(response => response.text())
                .then(data => {
                    console.log('Success:', data);
                    document.getElementById('status').textContent = 'Status: ' + data;
                })
                .catch((error) => {
                    console.error('Error:', error);
                    document.getElementById('status').textContent = 'Status: Failed to send command';
                });
        }

        function updateCameraStream() {
            const ipAddress = '192.168.4.1'; // Update to your Arduino's IP
            const cameraURL = `http://${ipAddress}:81/stream`; // URL for camera stream
            document.getElementById('cameraStream').src = cameraURL;
        }

        // Initialize camera stream
        updateCameraStream();
    </script>
</body>
</html>
